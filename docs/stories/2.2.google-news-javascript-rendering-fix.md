# Story 2.2: Google News JavaScript Rendering Fix

## Story
**As a** system operator
**I want** the Google News crawling functionality to return actual article URLs
**So that** the system can extract real news content instead of returning 0 results

## Problem Analysis
The current crawling system has architectural confusion leading to 0 URL results:

### Root Cause Identified
1. **CLOUDSCRAPER_ENABLED=True** by default in configuration
2. System uses **CloudScraper custom HTML parsing** instead of newspaper4k/gnews
3. **CSS selectors in `_parse_google_news_html()` are outdated**
4. **No fallback mechanism** when CloudScraper parsing fails
5. Result: 0 URLs found consistently

### Current Flow (BROKEN)
```
CloudScraper enabled → Custom HTML parsing → FAIL → NO FALLBACK → 0 results
```

### Expected Flow (SHOULD BE)
```
newspaper4k GoogleNewsSource → gnews.get_news() → Real URLs → Success
```

## Acceptance Criteria
- [ ] **MUST** respect existing codebase architecture
- [ ] **MUST** choose ONE primary approach (CloudScraper OR newspaper4k/gnews)
- [ ] **MUST** implement proper fallback mechanism
- [ ] **MUST** return actual article URLs for Vietnamese crypto keywords
- [ ] **MUST** maintain existing configuration flexibility
- [ ] System should return >0 URLs for search: "bitcoin", "tai san ma hoa", "ethusd"

## Technical Requirements

### Option 1: Fix CloudScraper Approach (Recommended)
- Update CSS selectors in `src/core/crawler/engine.py/_parse_google_news_html()`
- Research current Google News HTML structure
- Implement robust selector patterns
- Add fallback to newspaper4k when CloudScraper fails

### Option 2: Prioritize newspaper4k/gnews Approach
- Set `CLOUDSCRAPER_ENABLED=False` by default
- Ensure newspaper4k GoogleNewsSource works properly
- Keep CloudScraper as fallback option

### CRITICAL: Developer Instructions
**⚠️ TON TRONG CODEBASE - RESPECT EXISTING ARCHITECTURE**

1. **DO NOT** remove existing CloudScraper implementation
2. **DO NOT** remove newspaper4k/gnews integration
3. **ANALYZE** current codebase before making changes
4. **FOLLOW** existing patterns and conventions
5. **TEST** both approaches to understand current state
6. **IMPLEMENT** proper error handling and logging
7. **MAINTAIN** configuration flexibility

## Tasks/Subtasks
- [ ] **Research Phase**
  - [ ] Analyze current Google News HTML structure
  - [ ] Test newspaper4k/gnews functionality separately
  - [ ] Identify working CSS selectors for current Google News

- [ ] **Implementation Phase**
  - [ ] Update CloudScraper CSS selectors OR disable CloudScraper
  - [ ] Implement proper fallback mechanism
  - [ ] Add comprehensive error handling
  - [ ] Add debug logging for troubleshooting

- [ ] **Testing Phase**
  - [ ] Test with Vietnamese keywords: "bitcoin", "tai san ma hoa", "ethusd"
  - [ ] Verify URLs are extracted successfully
  - [ ] Test both CloudScraper and newspaper4k approaches
  - [ ] Verify fallback mechanism works

## Definition of Done
- [ ] System returns >0 URLs for test keywords
- [ ] Proper error handling and logging implemented
- [ ] Fallback mechanism functional
- [ ] Code follows existing architecture patterns
- [ ] No regression in other functionality
- [ ] Configuration options maintained

## Priority
**HIGH** - Core crawling functionality is broken

## Estimated Effort
**Medium** - 4-8 hours (research + implementation + testing)

## Dev Notes
Based on QA analysis findings:
- Current architecture has dual approach (CloudScraper + newspaper4k)
- CloudScraper priority but CSS selectors outdated
- newspaper4k/gnews available but never used due to CloudScraper priority
- Need to respect existing codebase design choices

## Testing
- [ ] Test crawl with Vietnamese crypto keywords
- [ ] Verify URL extraction returns real URLs
- [ ] Test error handling when approaches fail
- [ ] Verify configuration settings work properly

---
**Status:** TODO
**Assigned to:** Dev Agent
**Created:** 2025-01-19
**Last Updated:** 2025-01-19