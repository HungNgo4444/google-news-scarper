# Story 2.2: Integrated Category Scheduling - Quick Start

## ‚úÖ What's Complete

### Backend (100% Complete)
- ‚úÖ Database migration applied
- ‚úÖ Category scheduling fields added
- ‚úÖ Job type differentiation (SCHEDULED vs ON_DEMAND)
- ‚úÖ Celery Beat scanner running every 60 seconds
- ‚úÖ API endpoints for schedule management
- ‚úÖ System capacity validation

### Frontend (60% Complete)
- ‚úÖ Core components created
- ‚ö†Ô∏è Integration pending (~4 hours work)

## üöÄ Quick Test

### 1. Enable Schedule for a Category

```bash
# Get a category ID
curl http://localhost:8000/api/v1/categories | jq '.categories[0].id'

# Enable 30-minute schedule
CATEGORY_ID="your-category-id"
curl -X PATCH http://localhost:8000/api/v1/categories/$CATEGORY_ID/schedule \
  -H "Content-Type: application/json" \
  -d '{"enabled": true, "interval_minutes": 30}'
```

### 2. Watch Scheduler Work

```bash
# Terminal 1: Watch Beat logs
docker-compose logs -f beat

# Terminal 2: Watch Worker logs
docker-compose logs -f worker | grep -E "(SCHEDULED|schedule_scan)"
```

You should see:
- Every 60 seconds: "Starting scheduled categories scan"
- When a job is due: "Triggered scheduled job for category {name}"

### 3. Check Results

```bash
# Get schedule config
curl http://localhost:8000/api/v1/categories/$CATEGORY_ID/schedule | jq

# Check scheduled jobs
curl "http://localhost:8000/api/v1/jobs?limit=10" | jq '.jobs[] | select(.job_type=="SCHEDULED")'

# Check system capacity
curl http://localhost:8000/api/v1/categories/schedules/capacity | jq
```

## üìä Database Schema

```sql
-- Categories schedule fields
ALTER TABLE categories ADD COLUMN schedule_enabled BOOLEAN DEFAULT false;
ALTER TABLE categories ADD COLUMN schedule_interval_minutes INTEGER;
ALTER TABLE categories ADD COLUMN last_scheduled_run_at TIMESTAMP WITH TIME ZONE;
ALTER TABLE categories ADD COLUMN next_scheduled_run_at TIMESTAMP WITH TIME ZONE;

-- Jobs type field
CREATE TYPE job_type_enum AS ENUM ('SCHEDULED', 'ON_DEMAND');
ALTER TABLE crawl_jobs ADD COLUMN job_type job_type_enum DEFAULT 'ON_DEMAND';
```

## üéØ Frontend Components Ready

### ScheduleConfig.tsx
Toggle + interval selector for category forms

### ScheduleStatusBadge.tsx
Display "üïí 30 min" or "‚è∏Ô∏è Disabled"

### JobTypeBadge.tsx
Display "üïí Scheduled" or "üë§ Manual"

## üìù Next Steps

See [story-2.2-implementation-summary.md](../implementation/story-2.2-implementation-summary.md) for:
- Detailed frontend integration guide
- Complete API documentation
- Troubleshooting tips
- Testing procedures

## üîß Disable a Schedule

```bash
curl -X PATCH http://localhost:8000/api/v1/categories/$CATEGORY_ID/schedule \
  -H "Content-Type: application/json" \
  -d '{"enabled": false}'
```

## üìà System Limits

- **Normal**: < 60 jobs/hour
- **Warning**: 60-99 jobs/hour
- **Critical**: ‚â• 100 jobs/hour (hard limit)

---

**Status**: Backend Complete ‚úÖ | Frontend Integration Pending ‚ö†Ô∏è
